---
# source archive
apiVersion: tekton.dev/v1alpha1
kind: PipelineResource
metadata:
  name: {{.PipelineResource.SourceID}}
  labels:
    project: dracon
spec:
  type: storage
  params: [{name: location, value: s3://dracon/{{.PipelineResource.SourceID}}}, {name: type, value: gcs}, {name: dir, value: "y"}]
  secrets: [{fieldName: BOTO_CONFIG, secretName: dracon-storage, secretKey: boto_config}]
---
# bandit out
apiVersion: tekton.dev/v1alpha1
kind: PipelineResource
metadata:
  name: {{.PipelineResource.ProducerID "bandit"}}
  labels:
    project: dracon
spec:
  type: storage
  params: [{name: location, value: s3://dracon/{{.PipelineResource.ProducerID "bandit"}}}, {name: type, value: gcs}, {name: dir, value: "y"}]
  secrets: [{fieldName: BOTO_CONFIG, secretName: dracon-storage, secretKey: boto_config}]
---
# gosec out
apiVersion: tekton.dev/v1alpha1
kind: PipelineResource
metadata:
  name: {{.PipelineResource.ProducerID "gosec"}}
  labels:
    project: dracon
spec:
  type: storage
  params: [{name: location, value: s3://dracon/{{.PipelineResource.ProducerID "gosec"}}}, {name: type, value: gcs}, {name: dir, value: "y"}]
  secrets: [{fieldName: BOTO_CONFIG, secretName: dracon-storage, secretKey: boto_config}]
---
# spotbugs out
apiVersion: tekton.dev/v1alpha1
kind: PipelineResource
metadata:
  name: {{.PipelineResource.ProducerID "spotbugs"}}
  labels:
    project: dracon
spec:
  type: storage
  params: [{name: location, value: s3://dracon/{{.PipelineResource.ProducerID "spotbugs"}}}, {name: type, value: gcs}, {name: dir, value: "y"}]
  secrets: [{fieldName: BOTO_CONFIG, secretName: dracon-storage, secretKey: boto_config}]
---
# enricher out
apiVersion: tekton.dev/v1alpha1
kind: PipelineResource
metadata:
  name: {{.PipelineResource.EnricherID}}
  labels:
    project: dracon
spec:
  type: storage
  params: [{name: location, value: s3://dracon/{{.PipelineResource.EnricherID}}}, {name: type, value: gcs}, {name: dir, value: "y"}]
  secrets: [{fieldName: BOTO_CONFIG, secretName: dracon-storage, secretKey: boto_config}]
---
# git+https config
apiVersion: tekton.dev/v1alpha1
kind: PipelineResource
metadata:
  name: {{.PipelineResource.ID "git-github-thoughtmachine-please" }}
  labels:
    project: dracon
spec:
  type: git
  params:
  - name: revision
    value: master
  - name: url
    value: https://github.com/thought-machine/please.git
---
# pipelinerun
apiVersion: tekton.dev/v1alpha1
kind: PipelineRun
metadata:
  name: {{.PipelineRun.Name "demo"}}
  labels:
    project: dracon
spec:
  pipelineRef: {name: {{.Pipeline.Name "demo"}}}
  params: [
    {{.PipelineRun.Params}}
  ]
  podTemplate: {}
  # serviceAccount: git-github-thoughtmachine-please # replace with desired git source service account (if needed)
  resources:
  - {name: git-source, resourceRef: {name: {{.PipelineResource.ID "git-github-thoughtmachine-please" }}}} # replace with desired git source
  - {{.PipelineRun.ResourceSource}}
  - {{.PipelineRun.ResourceProducers "bandit" "gosec"}}
  - {{.PipelineRun.ResourceEnricher}}
  timeout: 1h0m0s
